
<html>
<head>
    <meta charset="UTF-8">
</head>
<body>

<script src="css/socket.io.js"></script> <!-- include socket.io client side script -->
  <script src="css/jquery.min.js"></script>
  <script src="css/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="css/jquery-ui.css">


<link rel=stylesheet href="CM/doc/docs.css">

<link rel="stylesheet" href="CM/lib/codemirror.css">
<link rel="stylesheet" href="CM/theme/eclipse.css">
<link rel="stylesheet" href="CM/addon/dialog/dialog.css">
<link rel="stylesheet" href="CM/addon/search/matchesonscrollbar.css">
<script src="CM/lib/codemirror.js"></script>
<script src="CM/addon/edit/matchbrackets.js"></script>
<link rel="stylesheet" href="CM/addon/hint/show-hint.css">
<script src="CM/addon/hint/show-hint.js"></script>
<script src="CM/mode/clike/clike.js"></script>
<script src="CM/mode/octave/octave.js"></script>
<script src="CM/addon/dialog/dialog.js"></script>
<script src="CM/addon/search/searchcursor.js"></script>
<script src="CM/addon/search/search.js"></script>
<script src="CM/addon/scroll/annotatescrollbar.js"></script>
<script src="CM/addon/search/matchesonscrollbar.js"></script>
<script src="CM/addon/search/jump-to-line.js"></script>
<style>.CodeMirror {border: 2px inset #dee;}</style>


 <style>

    .selected{font-weight:bold; background: #FF99; color:#4caf50;}

</style>

  <script>

var cppEditor;

$(document).ready(function(){
   document.getElementById("src_view").value=" ";
   document.getElementById("compile_view").value=" ";
   document.getElementById("compile_view_tool").value=" ";
   cppEditor = CodeMirror.fromTextArea(document.getElementById("src_view"), {
        lineNumbers: true,
        matchBrackets: true,
        mode: "text/x-c++src",
        extraKeys: {"Alt-F": "findPersistent"},
        theme:'eclipse'
      });
   logEditor = CodeMirror.fromTextArea(document.getElementById("compile_view"), {
        lineNumbers: true,
        matchBrackets: true,
        mode: "text/x-octave",
        theme:'eclipse'
      });
    
  cppEditor.setSize("75%", "95%");
  logEditor.setSize("75%", "95%");
  
});

 function mover(x)
 {
	x.style.background='yellow';
 }
 function moverout(x)
 {
	x.style.background='lightgray';
 }
  
  $( function() {
    $( "#tabs" ).tabs();
  } );
  </script>


 <div id="tabs" style=" height:85%; width:100%; ">
  <ul>
    <li><a href="#tabs-1" style=" background: #ffffc8;">Edit Marlin</a></li>
    <li><a href="#tabs-2" style=" background: #ffffc8;">Run Marlin </a></li>
    <li><a href="#tabs-3" style=" background: #ffffc8;">Update Raspbian  </a></li>
   
  </ul>
  <div id="tabs-1" style=" height:95%; width:95%; float: left;">

    <p id="errlog_view"   style=""></p>

    <div id="radio">
    <a    id="radio31" name="radio" onclick="cppEditor.execCommand('find')" checked="checked" ><label for="radio31"  >Search</label></a>
    <a    id="radio32" name="radio" onclick="cppEditor.execCommand('findNext')" checked="checked" ><label for="radio32"  >Next</label></a>
    <a    id="radio33" name="radio" onclick="cppEditor.execCommand('findPrev')" checked="checked" ><label for="radio33"  >Prev</label></a>
    <a    id="radio11" name="radio" onclick="Save_src()" checked="checked" ><label for="radio11"  >Save changes</label></a>
    <a   id="radio21" name="radio" onmouseover="Downlaod_detail(this)" onmouseout="Downlaod_undetail(this)" onclick="$( '#dialog-confirm').dialog({title:'Download Marlin source code?'}).dialog('open');"  ><label for="radio21">Update source</label></a>
    </div>
   <div style=" height:95%;overflow-x:auto; overflow-y:auto; float: right;width:20%">
		<table id="src_list" style="height:10%;width:100%;float:left; background: #ffffc8;"> </table>
		<input type="button"  id="list_bu" onclick="list_show_f()" style="float:left;position: relative;right:0%;top:0%;width:100%" value="Backed up"> 
		<input type="button"  id="list_delete" onclick=" $( '#dialog-confirm').dialog({title:'Delete All the Backed up Files?'}).dialog('open');"  style="float:left;position: relative;right:0%;top:0%;width:50%;visibility:hidden;" value="Delete All"> 
		<table id="src_list2" style="height:10%;width:100%;float:left;visibility:hidden; background: #ffffff;"> </table>
    </div>
    <p>
		<textarea id="src_view" cols="50" rows="100" style=" height:95%; width:75%; float: left;top:0px;"></textarea>
	 </p>
	
  </div>
  <div id="tabs-2" style=" height:85%; width:95%; float: left;">

    <div id="radio20">
    <input type="radio" id="radio12" name="radio" onclick="Compile_src(1)" checked="checked" ><label for="radio12">Compile</label>
    <input type="radio" id="radio22" name="radio"  onclick="Compile_src(2)"  ><label for="radio22">Run </label>
    
    </div>
     <p>
		<textarea id="compile_view" cols="50" rows="200" style=" height:95%; width:75%; float: left;"></textarea>
	 </p>
  </div>
  <div id="tabs-3" style=" height:85%; width:95%; float: left;">

    <a onclick=" $( '#dialog-confirm').dialog({title:'Update Raspbian?'}).dialog('open');"  >Update Raspbian</a>

 	<p>
		<textarea id="compile_view_tool" cols="50" rows="100" style=" height:95%; width:75%; float: left;"></textarea>
	 </p>    
  </div>
</div>

<img src="css/105842.jpg"  style=" position:absolute;height:50px; width:150px;right:0%;top:11px" onclick="window.open('http://www.pandapi3d.com')">

 	 <div id="dialog-confirm"  >
 	  <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span> </p>
 	</div>





    

<script>
var updateing=0;
function Downlaod_detail(x)
{	 
	x.text = "Update Marlin source code from Pandapi github";
}

function Downlaod_undetail(x)
{
   x.text = "Update source";
}


function src_list_check(check_file_name)
{
    var ret=0;
	$('#src_list tr').each(function(i){                  
		$(this).children('td').each(function(j){   
		 
		 if(check_file_name==$(this).text()){
		 
		  ret=1;
		  }
		});
	});

	$('#src_list2 tr').each(function(i){                   // ± 
		$(this).children('td').each(function(j){  // ±éÀú tr µÄ¸÷¸ö td
		// alert("µÚ"+(i+1)+"ÐÐ£¬µÚ"+(j+1)+"¸ötdµÄÖµ£º"+$(this).text()+"¡£");
		 if(check_file_name==$(this).text())
		  ret=1;
		});
	});
	
	return ret;
}

$("#wiki").unbind('click');

$(function() {
    $( "#dialog-confirm" ).dialog({
      resizable: false,
      autoOpen: false,
      height:140,
      modal: true,
      buttons: {
        "Yes": function() {
          $( this ).dialog( "close" );
          if($(this).dialog( "option", "title" ).indexOf('Marlin')>=0)
          	update_src(0);
          else if($(this).dialog( "option", "title" ).indexOf('Delete')>=0)
		  {
			update_Delete_file();
			setTimeout("window.location.reload()",2000);
			
		  }
          else
            update_src(1);
        },
        Cancel: function() {
          $( this ).dialog( "close" );

        }
       }
    });
  });
  
var ls_show=0;
function list_show_f()
{
	if(ls_show)
	{
		ls_show=0;
		document.getElementById('src_list2').style.visibility="hidden";
		document.getElementById('list_bu').value="Backed up";
		document.getElementById('list_delete').style.visibility="hidden";
	}
	else
	{
		ls_show=1;
		document.getElementById('src_list2').style.visibility="visible";
		document.getElementById('list_bu').value="hidden";
		document.getElementById('list_delete').style.visibility="visible";
	}

}

//background-color:#FD7F00
//background-color: rgb(255, 215, 0)
 $(function() {
    $( "input[type=submit], a, button" )
      .button()
      .click(function( event ) {
        event.preventDefault();
      });
  });


 $(function() {
    $( "#radio" ).buttonset();
    $( "#radio20" ).buttonset();
  });

 $(function() {
    $( "#dialog" ).dialog({
      autoOpen: false,
      width:500,
      height:300,
      show: {
        effect: "blind",
        duration: 1000
      },
      hide: {
        effect: "explode",
        duration: 1000
      }
    });
 
  });
  
var socket = io(); //load socket.io-client and connect to the host that serves the page
window.addEventListener("load", function(){ //when page loads
 // var lightbox = document.getElementById("light");
 // lightbox.addEventListener("change", function() { //add event listener for when checkbox changes
  //  socket.emit("light", Number(this.checked)); //send button status to server (as 1 or 0)
 // });
 all_compile_flag=0;
 // document.getElementById("src_view")
});

socket.on('src_view', function (data) { //get button status from client
  
 //document.getElementById("src_view").value = data; //change checkbox according to push button on Raspberry Pi
 cppEditor.getDoc().setValue(data);

  //socket.emit("light", data); //send push button status to back to server
});

socket.on('src_view_down', function (data) { //get button status from client
 var data1=cppEditor.getDoc().getValue()+data;
  cppEditor.getDoc().setValue(data1);
 //document.getElementById("src_view").value += data; //change checkbox according to push button on Raspberry Pi
  //socket.emit("light", data); //send push button status to back to server
});
socket.on('compile_view_tool', function (data) { //get button status from client
  
 document.getElementById("compile_view_tool").value += data; //change checkbox according to push button on Raspberry Pi
  //socket.emit("light", data); //send push button status to back to server
});

socket.on('alert_dialog', function (data) {  
  alert(data);



});

socket.on('src_compile_log', function (data) { //get button status from client

  	
  	var data2=logEditor.getDoc().getValue()+data;
     logEditor.getDoc().setValue(data2);
     
    logEditor.setCursor(logEditor.getDoc().lineCount(),0);
	// document.getElementById("compile_view").value += data; //change checkbox according to push button on Raspberry Pi

	 if(data2.indexOf("make: Leaving directory '/")>=0)
	 {
	 	if((data2.indexOf("' failed")>=0)||
	 	  (data2.indexOf(" Error ")>=0))
	 	{
            
	 		
	 		document.getElementById("compile_view").value += "compile failed !";
	 		data2=logEditor.getDoc().getValue()+"compile failed !";
            logEditor.getDoc().setValue(data2);
            
          //  setTimeout("logEditor.getDoc().setValue(logEditor.getDoc().getValue()+' ');logEditor.scrollTo(null,logEditor.getDoc().lineCount());",1000);
            
            logEditor.setCursor(logEditor.getDoc().lineCount(),0);
            
           // logEditor.getDoc().markText({line:1,ch:1},{line:3,ch:1},{css:"color: #ff0000"});
            
             alert("compile failed");
	 	}
	 	else
	 	{
			alert("compile ok");
			//document.getElementById("compile_view").value += "compile OK ! you can click run now";
			data2=logEditor.getDoc().getValue()+"compile OK ! you can click run now";
            logEditor.getDoc().setValue(data2);
             
		}
		  $("#radio20").prop("disabled", false);
		  $("#radio12").prop("disabled", false);
		  $("#radio22").prop("disabled", false);
		  
	 }
	 else if(data2.indexOf("arm-linux-gnueabihf-strip pi_marlin")>=0)
	 {
			alert("compile ok");
			all_compile_flag=0;
		  $("#radio20").prop("disabled", false);
		  $("#radio12").prop("disabled", false);
		  $("#radio22").prop("disabled", false);
		 // document.getElementById("compile_view").value += "compile ok";
		  data2=logEditor.getDoc().getValue()+"compile ok";
          logEditor.getDoc().setValue(data2);
	 }
	 else if(data2.indexOf("Sd2Card.cpp -o Sd2Card.o")>=0)
	 {
	 //	if(all_compile_flag==1)
	 		//Compile_src(0);
	 //	 all_compile_flag=0;
	 }
	 if(data2.length>1024*100)
	 {
	 	data2.value='';
	 	 
        logEditor.getDoc().setValue("");
        
	 }
	 //var obj = document.getElementById("compile_view");
	 // obj.scrollTop = obj.scrollHeight; // good
});
socket.on('src_err', function (data) { //get button status from client  
  document.getElementById("errlog_view").innerHTML = data;
  document.getElementById("errlog_view").style = "color:red";

});
socket.on('src_log', function (data) { //get button status from client  
  document.getElementById("errlog_view").innerHTML = data;
  document.getElementById("errlog_view").style = "color:green";
  alert(data);
});


socket.on('src_list', function (data) { //get button status from client  
  if(data=='Configuration.h'||data=='Configuration_adv.h'||data=='Marlin_main.cpp'||data=='pins_PANDA_PI.h')
  {
      if(src_list_check(data)==0)
      {
		  var y = document.getElementById('src_list').insertRow(0).insertCell(0);
		  y.innerHTML  = data;
		  if(data=='Configuration.h')
		  	$('#src_list tr').addClass('selected'); 
		  document.getElementById('src_list').style.overflow="auto";
	  }
  }
  else
  {
  	if(src_list_check(data)==0)
  	{
	  var y = document.getElementById('src_list2').insertRow(0).insertCell(0);
	  y.innerHTML  = data;
	  document.getElementById('src_list2').style.overflow="auto";
	 }
  }
});

var select_name="Configuration.h";
////////////////
 $('#src_list').on('click','tr', function() {
	  
	 socket.emit("src_select", $(this).text());
	 select_name=$(this).text();
	 $(this).siblings('tr').removeClass('selected');  //  
	 $('#src_list2 tr').removeClass('selected');
	 $(this).addClass('selected');                            //  
});
//////////////
 $('#src_list2').on('click','tr', function() {
	  
	 socket.emit("src_select", $(this).text());
	 select_name=$(this).text();
	 $(this).siblings('tr').removeClass('selected');  //  
	 $('#src_list tr').removeClass('selected');
	 $(this).addClass('selected');                            //  
});

function Save_src()
{
    if(updateing==1)
    {
      alert("If the update is complete, please reload this page");
      return;
    }
	//var src_o=document.getElementById("src_view").value;
	var src_o=cppEditor.getDoc().getValue();
	//alert(src_o);
	socket.emit("src_write",select_name+"|luojin|"+src_o);
}
function Compile_src(run_s)
{	
	 $( "#dialog" ).dialog( "open" );
	if(run_s==0)
	{
	 //   document.getElementById("compile_view").value="Compiling ...";
		socket.emit("src_compile","");
		logEditor.getDoc().setValue("Compiling ...");
		all_compile_flag=1;
		$( '#radio20 input' ).attr( 'disabled', true);
		$( '#radio12 input' ).attr( 'disabled', true);
		$( '#radio22 input' ).attr( 'disabled', true);
		 
	}
	else if(run_s==1)
	{
	   // document.getElementById("compile_view").value="Compiling All, may need more than several minutes ...";
		socket.emit("src_compile","all");
		all_compile_flag=1;
        logEditor.getDoc().setValue("Compiling All, may need more than several minutes ...");
		 $("#radio20").prop("disabled", true);
		 $("#radio12").prop("disabled", true);
		 $("#radio22").prop("disabled", true);
	}
	else if(run_s==2)
	{
	   //document.getElementById("compile_view").value="The printer application will automatically restart within 10 seconds\n";
	   socket.emit("src_run","");
	   logEditor.getDoc().setValue("The printer application will automatically restart within 10 seconds\n");
	   
	}
	
}

function update_Delete_file()
{
	socket.emit("src_update","delete_file"); 	
}

function update_src(rindex)
{
	if(rindex==0)
	{
		 $( "#dialog" ).dialog( "open" );
		// document.getElementById("compile_view").value="Updating marlin..\n\n";
		updateing=1;
		
      //  document.getElementById("src_view").value="Updating marlin...\n\n";
         cppEditor.getDoc().setValue("Updating marlin...\n\n");
		socket.emit("src_update","marlin");
		  
		 
		 
		 
	}
	if(rindex==1)
	{
		 updateing=1;
		 $( "#dialog" ).dialog( "open" );
		 document.getElementById("compile_view_tool").value="updateing web_tools..\n";

		socket.emit("src_update","web_tools");
		 
	}
}

</script>
</html>
</body>
</html>
